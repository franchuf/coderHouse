<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/socket.io/socket.io.js"></script>
    <title>Document</title>
</head>
<body>
    <form action="/api/productos" method="post">
        <input type="text" name="title" placeholder="articulo">
        <input type="number" name="price" placeholder="precio">
        <input type="text" name="thumbnail" placeholder="url">
        <button type="submit" name="submit">Enviar</button>
    </form>
    <span><a href="/productos">ver productos cargados</a> </span>
    <p id='info'>aca apareceran los productos</p>
</body>
<form onsubmit="return addMessage(this)">
    <input type="text" id="username" placeholder="Tu Nombre" >
    <input type="text" id="texto" placeholder="Cuéntanos algo...">
    <input type="submit" value="Enviar">
</form>
<div id='messages'></div>
<script>
const socket = io();
socket.on('productos', data=>{
    document.getElementById('info').innerHTML = JSON.stringify(data)
    })
function render(data) {
    const today = new Date()
    const html = data.map((elem, index) => {
        return(`<div>
            <strong>${today}${elem.author}</strong>:
            <em>${elem.text}</em> </div>`)
    }).join(" ");
    document.getElementById('messages').innerHTML = html;
}

socket.on('messages', function(data) { render(data); });


    function addMessage(e) {
    const mensaje = {
        author: document.getElementById('username').value,
        text: document.getElementById('texto').value
    };
    socket.emit('new-message',  mensaje);
    return false;
}
</script>

<!-- no me estaría tomando la ruta del js por eso voy a dejar el script embebido en el html -->

</html>